 # chapter4练习: 获取任务信息

## 任务实现

在 syscall/process.rs 中添加系统调用返回时间与 Taskinfo，添加新系统调用 mmap / unmap,使用 TASK_MANAGER 中新添加的方法进行匿名映射。

主要逻辑在 mm/memory_set.rs 中，进行地址转换，验证请求是否合法，并进行映射。

## 简答题

### 问题 1

> 仅当 V(Valid) 位为 1 时，页表项才是合法的；
> R/W/X 分别控制索引到这个页表项的对应虚拟页面是否允许读/写/取指；
> U 控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；
> G 我们不理会；
> A(Accessed) 记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；
> D(Dirty) 则记录自从页表项上的这一位被清零之后，页表项的对应虚拟页表是否被修改过。

### 问题 2

1. Store Fault / StorePage Fault
2. sstatus 包含一系列状态位，例如其 SPP 字段表示 Trap 发生前 CPU 处于的特权级，sepc 记录 Trap 发生之前执行的最后一条指令的地址，在用户态，sscratch 保存内核栈的地址；在内核态，sscratch 的值为 0。
3. 节省内存，节省加载时间
4. 每 8 字节页表项对应 4KiB 的页表， 10GiB 对应 20MiB
5. 分配时只分配程序要求的一小部分，剩下的保存在数据结构中，例如每个 task 使用一个线段树保存，程序要求访问时引发缺页，操作系统查询是否在程序空间内，若在，分配并返回；若不在，报错终止程序。
6. 页表项 D 位为 1

### 问题 3

1. 在内核态修改页表项，satp CSR 等，执行 vfence.vma
2. 设置 U 标志位
3. 实现简单，占用空间小
4. 在用户态、内核态转换时只切换页表，在切换任务时更改用户的页表

## 说明

1. 在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

* 未进行过交流

2. 此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

* 部分简答题参考了 [The RISC-V Instruction Set Manual: Volume II](https://github.com/riscv/riscv-isa-manual/releases/download/20240411/priv-isa-asciidoc.pdf)

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。